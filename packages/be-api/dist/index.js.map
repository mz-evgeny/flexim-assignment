{"version":3,"sources":["../src/utils/db.ts","../src/schemas/supplier.ts","../src/models/supplier.ts","../src/schemas/product.ts","../src/models/product.ts","../src/storage/products.ts","../src/storage/suppliers.ts","../src/index.ts"],"names":["connect","mongoose","disconnect","SupplierSchema","Schema","Supplier","model","ProductSchema","Product","getProducts","page","limit","sortField","sortOrder","searchTerm","skip","match","sortOptions","result","total","getSuppliers","app","express","port","cors","req","res","closeApp"],"mappings":"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","file":"index.js","sourcesContent":["import mongoose from \"mongoose\";\n\nexport const connect = async (): Promise<void> => {\n  await mongoose.connect(\n    process.env.MONGO_URI || \"mongodb://127.0.0.1:27017/flexim\"\n  );\n};\n\nexport const disconnect = async (): Promise<void> => {\n  await mongoose.disconnect();\n};\n","import { Schema } from \"mongoose\";\nimport { Supplier } from \"src/interfaces/supplier\";\n\nexport const SupplierSchema = new Schema<Supplier>({\n  name: { type: String, required: true },\n  country: { type: String, required: true },\n});\n","import { model } from \"mongoose\";\nimport { SupplierSchema } from \"src/schemas/supplier\";\n\nexport const Supplier = model(\"Supplier\", SupplierSchema);\n","import { Schema } from \"mongoose\";\nimport { Product } from \"src/interfaces/product\";\nimport { Supplier } from \"src/models/supplier\";\n\nexport const ProductSchema = new Schema<Product>({\n  sku: { type: String, required: true, unique: true },\n  name: { type: String, required: true },\n  description: { type: String, required: true },\n  supplierId: { type: Schema.Types.ObjectId, ref: Supplier, required: true },\n  manufacturingDate: { type: Date, required: true },\n});\n","import { model } from \"mongoose\";\nimport { ProductSchema } from \"src/schemas/product\";\n\nexport const Product = model(\"Product\", ProductSchema);\n","import { Product } from \"src/models/product\";\nimport { Product as IProduct } from \"src/interfaces/product\";\n\ninterface QueryString {\n  page?: number;\n  limit?: number;\n  sortField?: string;\n  sortOrder?: \"asc\" | \"desc\";\n  searchTerm?: string;\n}\n\ninterface Result {\n  data: IProduct[];\n  total: number;\n  page: number;\n  totalPages: number;\n}\n\nexport async function getProducts({\n  page = 1,\n  limit = 50,\n  sortField = \"sku\",\n  sortOrder = \"asc\",\n  searchTerm = \"\",\n}: QueryString): Promise<Result> {\n  const skip = (page - 1) * limit;\n\n  const match: any = {};\n  if (searchTerm) {\n    match.$or = [\n      { sku: { $regex: searchTerm, $options: \"i\" } },\n      { name: { $regex: searchTerm, $options: \"i\" } },\n    ];\n  }\n\n  const sortOptions: any = {};\n  if (sortField === \"supplier\") {\n    sortOptions[\"supplier.name\"] = sortOrder === \"asc\" ? 1 : -1;\n  } else {\n    sortOptions[sortField] = sortOrder === \"asc\" ? 1 : -1;\n  }\n\n  const [result] = await Product.aggregate([\n    { $match: match },\n    {\n      $lookup: {\n        from: \"suppliers\",\n        localField: \"supplierId\",\n        foreignField: \"_id\",\n        as: \"supplier\",\n      },\n    },\n    { $unwind: \"$supplier\" },\n    {\n      $facet: {\n        data: [\n          { $sort: sortOptions },\n          { $skip: skip },\n          { $limit: limit },\n          {\n            $project: {\n              _id: 1,\n              sku: 1,\n              name: 1,\n              description: 1,\n              supplierId: \"$supplier._id\",\n              manufacturingDate: 1,\n            },\n          },\n        ],\n        total: [{ $group: { _id: null, count: { $sum: 1 } } }],\n      },\n    },\n  ]);\n\n  const total = result.total[0]?.count || 0;\n\n  return {\n    data: result.data,\n    total,\n    page,\n    totalPages: Math.ceil(total / limit),\n  };\n}\n","import { Supplier as ISupplier } from \"src/interfaces/supplier\";\nimport { Supplier } from \"src/models/supplier\";\n\nexport const getSuppliers = async (): Promise<ISupplier[]> => {\n  const result = await Supplier.find().lean();\n\n  return result;\n};\n","import express from \"express\";\nimport { connect, disconnect } from \"src/utils/db\";\nimport { getProducts } from \"./storage/products\";\nimport { getSuppliers } from \"./storage/suppliers\";\nimport cors from \"cors\";\n\nconst app = express();\nconst port = 8000;\n\napp.use(cors());\n\napp.get(\"/products\", async (req, res) => {\n  const result = await getProducts(req.query);\n\n  res.send(result);\n});\n\napp.get(\"/suppliers\", async (req, res) => {\n  const result = await getSuppliers();\n\n  res.send(result);\n});\n\napp.listen(port, async () => {\n  await connect();\n  console.info(`ðŸš€ Server ready at port : ${port}`);\n});\n\nconst closeApp = async () => {\n  await disconnect();\n  console.info(\"ðŸ›‘ Database connection closed.\");\n  process.exit(0);\n};\n\nprocess.on(\"SIGINT\", closeApp);\nprocess.on(\"SIGTERM\", closeApp);\n"]}